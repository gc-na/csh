<!--
Meta Description: # C 語言中的 `strncpy` 函數：用於字串拷貝的安全方法 ## 概述 `strncpy` 是 C 語言中用於將字串從來源拷貝到目標的函數，並且可以指定拷貝的最大字符數。此函數有助於避免緩衝區溢出，增強字串操作的安全性。 ## 文檔 ### 目的 `strncpy` 函數的主要目的是將一個字...
Meta Keywords: dest, strncpy, char, src, 拷貝的字串
-->

# C 語言中的 `strncpy` 函數：用於字串拷貝的安全方法

## 概述
`strncpy` 是 C 語言中用於將字串從來源拷貝到目標的函數，並且可以指定拷貝的最大字符數。此函數有助於避免緩衝區溢出，增強字串操作的安全性。

## 文檔
### 目的
`strncpy` 函數的主要目的是將一個字串的內容拷貝到另一個字串中，並且最多拷貝指定的字符數。當拷貝的字元數少於指定數量時，會自動在目標字串的末尾填充空字元（`'\0'`）。

### 語法
```c
char *strncpy(char *dest, const char *src, size_t n);
```

### 參數
- `dest`：指向目標字串的指標，將在此處存放拷貝的字串。
- `src`：指向來源字串的指標，從這裡拷貝字串內容。
- `n`：要拷貝的最大字符數。

### 返回值
返回 `dest` 的指標。

### 使用方法
在使用 `strncpy` 時，必須確保 `dest` 有足夠的空間來容納拷貝的字串和可能的空字元。如果來源字串的長度大於或等於 `n`，則 `dest` 不會自動以空字元結束，這可能會導致後續的字串操作出現問題。

## 示例
以下是 `strncpy` 的基本使用示例：

```c
#include <stdio.h>
#include <string.h>

int main() {
    char dest[20];
    const char *src = "Hello, World!";
    
    // 拷貝前 5 個字符
    strncpy(dest, src, 5);
    dest[5] = '\0'; // 手動添加空字元
    printf("拷貝的字串: %s\n", dest); // 輸出: 拷貝的字串: Hello

    // 拷貝 20 個字符（超過來源字串長度）
    strncpy(dest, src, 20);
    printf("拷貝的字串: %s\n", dest); // 輸出: 拷貝的字串: Hello, World!

    return 0;
}
```

## 解釋
### 常見陷阱
1. **不添加空字元**：如果來源字串的長度大於或等於 `n`，則 `dest` 不會自動以空字元結束，因此必須手動添加。
2. **緩衝區溢出**：確保 `dest` 有足夠的空間以容納拷貝的字串及空字元，否則會導致緩衝區溢出。
3. **無法處理 Unicode**：`strncpy` 只適用於 C 字串，對於多字節字符（如 UTF-8）可能無法正確處理。

## 總結
`strncpy` 函數是一個強大但需要謹慎使用的字串拷貝工具，能有效避免緩衝區溢出，確保安全的字串操作。