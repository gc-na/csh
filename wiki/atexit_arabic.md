<!--
Meta Description: # الدالة atexit في لغة C: كيفية استخدامها وأهميتها ## ملخص دالة `atexit` في لغة C هي دالة مهمة تسجل الدوال التي سيتم استدعاؤها عند إنهاء البرنامج. تُس...
Meta Keywords: atexit, البرنامج, الدالة, الدوال, عند
-->

# الدالة atexit في لغة C: كيفية استخدامها وأهميتها

## ملخص
دالة `atexit` في لغة C هي دالة مهمة تسجل الدوال التي سيتم استدعاؤها عند إنهاء البرنامج. تُستخدم هذه الدالة لضمان تنفيذ بعض التعليمات البرمجية للتنظيف قبل مغادرة البرنامج.

## الوثائق
### الغرض
تتيح دالة `atexit` للمستخدمين تسجيل دوال معينة ليتم استدعاؤها تلقائيًا عند انتهاء تنفيذ البرنامج. يُعتبر هذا الأمر مفيدًا لإدارة الموارد، مثل تحرير الذاكرة أو إغلاق الملفات.

### الاستخدام
تُستخدم الدالة `atexit` كما يلي:
```c
#include <stdlib.h>

int atexit(void (*func)(void));
```
- **المعلمات**: 
  - `func`: مؤشر إلى الدالة التي سيتم استدعاؤها عند انتهاء البرنامج.
  
- **القيمة المرجعة**: 
  - ترجع `0` عند نجاح التسجيل، و`-1` في حالة الفشل.

### التفاصيل
يمكنك تسجيل عدة دوال باستخدام `atexit`. سيتم استدعاء هذه الدوال بالترتيب العكسي الذي تم تسجيلها به. يمكن استخدام هذه الدالة لتنفيذ عمليات التنظيف مثل تحرير الذاكرة، وإغلاق الملفات المفتوحة، أو إلغاء تخصيص الموارد.

## أمثلة
### مثال بسيط
```c
#include <stdio.h>
#include <stdlib.h>

void cleanup() {
    printf("Cleaning up resources...\n");
}

int main() {
    if (atexit(cleanup) != 0) {
        fprintf(stderr, "Failed to register cleanup function.\n");
        return EXIT_FAILURE;
    }

    printf("Program is running...\n");
    return EXIT_SUCCESS;
}
```
في هذا المثال، سيتم استدعاء دالة `cleanup` عند انتهاء البرنامج، مما ينبه المستخدم بأن الموارد قد تم تنظيفها.

### مثال مع دوال متعددة
```c
#include <stdio.h>
#include <stdlib.h>

void first_cleanup() {
    printf("First cleanup function called.\n");
}

void second_cleanup() {
    printf("Second cleanup function called.\n");
}

int main() {
    atexit(first_cleanup);
    atexit(second_cleanup);
    
    printf("Running main program...\n");
    return 0;
}
```
في هذا المثال، سيتم استدعاء `second_cleanup` قبل `first_cleanup` عند انتهاء البرنامج.

## الشرح
### الأخطاء الشائعة
- **فشل التسجيل**: إذا كانت الذاكرة غير كافية، قد تفشل الدالة `atexit` في تسجيل الدالة. ينبغي على المبرمج التحقق من القيمة المرجعة.
- **عدم استدعاء الدوال**: إذا تم إنهاء البرنامج بشكل غير طبيعي (مثل استخدام `exit` أو `abort`)، قد لا يتم استدعاء الدوال المسجلة.

### ملاحظات إضافية
- يمكن تسجيل حتى 32 دالة باستخدام `atexit` في معظم الأنظمة، لكن هذا العدد قد يختلف حسب منصة التشغيل.
- `atexit` لا تدعم الدوال التي تأخذ معاملات. يجب أن تكون الدوال المسجلة بدون معاملات.

## ملخص من سطر واحد
تتيح دالة `atexit` في لغة C تسجيل الدوال للتنفيذ عند إنهاء البرنامج، مما يساعد في إدارة الموارد وتنظيفها بشكل فعال.